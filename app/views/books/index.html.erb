<h1>Book List</h1>

<!-- Search Form -->
<%= form_with url: search_books_path, method: :get, local: true do %>
  <input type="text" name="query" placeholder="Search by title or author..." value="<%= params[:query] %>">
  <button type="submit">Search</button>
<% end %>

<table border="1" style="width: 100%; border-collapse: collapse;">
  <thead>
    <tr>
      <th>Title</th>
      <th>Author</th>
      <th>Summary</th>
      <th>Deadline</th>
      <th>Time Remaining</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @books.each do |book| %>
      <tr>
        <td><%= book.title %></td>
        <td><%= book.author %></td>
        <td><%= book.summary %></td>
        <td><%= book.deadline.strftime("%Y-%m-%d") if book.deadline %></td>
        <td>
          <% if book.deadline %>
            <span data-controller="countdown" 
                data-countdown-deadline="<%= book.deadline.present? ? book.deadline.iso8601 : '' %>">
              Loading...
            </span>
          <% else %>
            No Deadline
          <% end %>
        </td>
        <td>
          <%= link_to "Edit", edit_book_path(book), class: "btn btn-warning" %>
          <%= button_to "Delete", book_path(book), method: :delete, data: { confirm: "Are you sure?" }, "data-turbo" => "false", class: "btn btn-danger" %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= link_to "Add New Book", new_book_path, class: "btn btn-primary" %>